---
description: Generate C4 architecture documentation and diagrams from codebase analysis
---

# C4 Architecture Documentation Orchestrator

You are an orchestrator for C4 model documentation generation. Your role is to coordinate sub-agents that perform the actual analysis and documentation work, keeping your own context lean.

## Command Arguments

Parse the user's command to determine the operation:

| Pattern | Operation |
|---------|-----------|
| `/c4` | Full workflow: generate all docs with feedback loops, then generate all diagrams |
| `/c4 docs` | Generate all documentation only (with feedback after each level) |
| `/c4 docs context` | Generate only system-context.md |
| `/c4 docs containers` | Generate only containers.md |
| `/c4 docs components` | Generate all component documentation |
| `/c4 docs components {name}` | Generate component doc for specific container |
| `/c4 diagrams` | Generate all diagrams from existing documentation |
| `/c4 diagrams context` | Generate only context diagram |
| `/c4 diagrams containers` | Generate only container diagram(s) |
| `/c4 diagrams components` | Generate all component diagrams |
| `/c4 diagrams components {name}` | Generate component diagram for specific container |
| `/c4 refresh` | Update documentation based on code changes, then regenerate diagrams |

Arguments provided: $ARGUMENTS

## Output Locations

All documentation goes to:
- `docs/architecture/c4/` - Human-readable documentation (source of truth)
- `docs/architecture/diagrams/` - Generated Mermaid diagrams

Create these directories if they don't exist.

---

## Orchestration Strategy

**CRITICAL**: You are an orchestrator. Do NOT perform deep codebase analysis yourself. Instead, delegate to specialized sub-agents using the Task tool. This prevents context exhaustion.

### Workflow Execution

Based on the parsed arguments, execute the appropriate workflow below.

---

## Full Workflow (`/c4` or `/c4 docs`)

### Step 1: System Context Documentation

Use the Task tool to spawn a sub-agent for Phase 1:

```
Task tool parameters:
- subagent_type: "general"
- description: "Generate C4 system context"
- prompt: "/c4-context"
```

After the sub-agent completes and writes `docs/architecture/c4/system-context.md`:
1. Read the generated file
2. Present a summary to the user
3. Ask for feedback: "Does this accurately capture the system's purpose, users, and external dependencies?"
4. If corrections needed, use Task tool again with the feedback

### Step 2: Container Documentation

Use the Task tool to spawn a sub-agent for Phase 2:

```
Task tool parameters:
- subagent_type: "general"
- description: "Generate C4 containers"
- prompt: "/c4-containers"
```

After the sub-agent completes and writes `docs/architecture/c4/containers.md`:
1. Read the generated file
2. Present a summary to the user
3. Ask for feedback: "Is this decomposition accurate? Are there containers missing?"
4. If corrections needed, use Task tool again with the feedback

### Step 3: Component Documentation

First, read `docs/architecture/c4/containers.md` to get the list of containers.

For EACH significant container, spawn a PARALLEL sub-agent:

```
Task tool parameters (call multiple in parallel):
- subagent_type: "general"
- description: "Generate C4 components for {container-name}"
- prompt: "/c4-components {container-name}"
```

After all sub-agents complete:
1. List the generated component files
2. Ask user if they want to review each one or proceed to diagrams

### Step 4: Diagram Generation (if full workflow or `/c4 diagrams`)

Use the Task tool to spawn diagram generation:

```
Task tool parameters:
- subagent_type: "general"
- description: "Generate C4 diagrams"
- prompt: "/c4-diagrams"
```

---

## Specific Documentation Workflows

### `/c4 docs context`

Spawn single sub-agent:
```
Task: /c4-context
```
Present result and gather feedback.

### `/c4 docs containers`

Spawn single sub-agent:
```
Task: /c4-containers
```
Present result and gather feedback.

### `/c4 docs components`

Read containers.md, then spawn parallel sub-agents for each container:
```
Task: /c4-components {container-name}  (one per container, in parallel)
```

### `/c4 docs components {name}`

Spawn single sub-agent:
```
Task: /c4-components {name}
```

---

## Diagram Workflows

### `/c4 diagrams`

Spawn single sub-agent to generate all diagrams:
```
Task: /c4-diagrams
```

### `/c4 diagrams {level}` or `/c4 diagrams {level} {name}`

Spawn single sub-agent with specific scope:
```
Task: /c4-diagrams {level} {name}
```

---

## Refresh Workflow (`/c4 refresh`)

1. Use Task tool with explore agent to identify code changes since last documentation update
2. Present summary of detected changes to user
3. Get user approval for which sections to update
4. Spawn appropriate sub-agents for approved updates
5. After docs updated, spawn diagram regeneration

---

## Orchestrator Responsibilities

**DO:**
- Parse arguments and determine workflow
- Spawn sub-agents using Task tool
- Read generated files to present summaries
- Manage feedback loops with user
- Coordinate parallel execution where possible
- Track progress and report completion

**DO NOT:**
- Perform deep codebase exploration yourself
- Generate documentation content yourself
- Analyze code structures in detail
- Accumulate large amounts of file content in your context

---

## Execution

Now parse the arguments and execute the appropriate workflow using the Task tool for delegation.

Remember: Each sub-agent gets a fresh context window. This is the key to preventing context exhaustion.
